# 数据库

## 数据库基础

## Mysql

### 存储引擎

#### MyISAM 和 InnoDB 的区别

- MyISAM 不支持事务，InnoDB 支持
- MyISAM 只支持表级锁。InnoDB 支持行级锁和表级锁，默认是行级锁
- MyISAM 不支持外键，InnoDB 支持外键
- MyISAM不支持数据库异常崩溃后的修复；InnoDB 支持，依赖于 `redo log`使，用 **undo log(回滚日志)** 来保证事务的**原子性** 。

### 锁机制

**乐观锁与悲观锁**

悲观锁：在修改前就加锁，先取锁再访问

乐观锁：

​	乐观锁并未真正加锁，假设数据一般情况不会造成冲突，实现乐观锁的方式是记录数据版本，知道提交的时候才去锁定。

​	冲突检测和数据更新

### 事务

#### 数据事务的实现原理

InnoDB 使用redo log保证事务的持久性，使用undo log来保持事务的原子性，通过锁机制和MVCC来保持隔离性

#### 并发事务带来的问题

- 脏读
- 丢失更改
- 不可重复读
- 幻读

#### 事务隔离级别

- 读取未提交
- 读取已提交
- 可重复读
- 可串行化

### 索引

#### 索引的优缺点

**优点**

- 提高查询效率
- 创建唯一性索引，保证数据记录的唯一性

**缺点**

- 创建维护索引耗费时间，增删改，数据有索引，索引也要改
- 索引需要使用物理空间，耗费一定的空间

#### 索引的底层数据结构

**Hash表 & B+树**

mysql中MyISAM 引擎和 InnoDB 引擎都使用B+树作为索引结构

#### B 树& B+树两者有何异同

- b树所有节点既存放键key也存放数据data，b+只有叶子节点存放key和data，其他内节点只存放key
- b树的叶子节点都是独立的，b+树的叶子节点有一条引用链指向与它相邻的叶子节点
- b树的检索过程是对范围内的每个节点的关键字进行二分查找，b+树的检索 ，任何查找都是从根节点到叶子节点的过程，叶子节点的顺序检索很明显。

#### 索引类型

- 主键索引
- 唯一索引
- 普通索引
- 组合索引（注意最左前缀原则，因为b+树是按照从左到右建立搜索树的）
- 全文索引

#### 如何定位并优化慢查询Sql

- 根据慢日志定位慢查询sql
  - 执行show variables like '%quer%' 找到show_query_log
- 使用explain等工具分析sql
- 修改sql，尽量让sql走索引



### SQL语句

**select...for update**

> 调用select...for update会实现悲观锁，锁住数据

## Redis

